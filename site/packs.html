
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.11">
    
    
      
        <title>HDM Packs - HDM Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.3754935a.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/style.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hdm-packs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="HDM Documentation" class="md-header__button md-logo" aria-label="HDM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HDM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              HDM Packs
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="full-installation.html" class="md-tabs__link">
      HDM Full Installation
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="packs.html" class="md-tabs__link md-tabs__link--active">
      HDM Packs
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="HDM Documentation" class="md-nav__button md-logo" aria-label="HDM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    HDM Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="full-installation.html" class="md-nav__link">
        HDM Full Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          HDM Packs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="packs.html" class="md-nav__link md-nav__link--active">
        HDM Packs
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#arborescence" class="md-nav__link">
    Arborescence
  </a>
  
    <nav class="md-nav" aria-label="Arborescence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#propertiesjson" class="md-nav__link">
    Properties.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-scriptsh" class="md-nav__link">
    Bootstrap-script.sh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gestion-de-la-configuration" class="md-nav__link">
    Gestion de la configuration
  </a>
  
    <nav class="md-nav" aria-label="Gestion de la configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-liste-des-points-de-terminaisons-cibles" class="md-nav__link">
    1. Liste des points de terminaisons cibles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-configuration-des-pts-de-terminaisons-et-configuration-externe-des-pack" class="md-nav__link">
    2./3. Configuration des pts de terminaisons et configuration externe des pack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orchestration-des-packs" class="md-nav__link">
    Orchestration des packs
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="hdm-packs">HDM Packs</h1>
<p>Les Packs dans HDM sont des micro programmes autonomes qui permettent d'effectuer des traitements sur : </p>
<ul>
<li>Les bases de données (Metric Packs)</li>
<li>Les métriques (Rule Packs)</li>
</ul>
<p>Il n'existe que deux types de packs HDM pour le moment.</p>
<h2 id="arborescence">Arborescence</h2>
<p>L'arborescence des packs doit répondre à une norme afin de pouvoir élaborer des systèmes et services automatisés dans le futur.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Readme.md</td>
<td>Permet d'expliquer le fonctionnement du pack</td>
</tr>
<tr>
<td>requirements.txt</td>
<td>dépendances logiciels du pack</td>
</tr>
<tr>
<td>properties.json</td>
<td><a href="#propertiesjson">Properties.json</a></td>
</tr>
<tr>
<td>bootstrap-script.sh</td>
<td><a href="#bootstrap-scriptsh">bootstrap-script.sh</a></td>
</tr>
<tr>
<td>/process</td>
<td>Le dossier process contient le programme en tant que tel</td>
</tr>
<tr>
<td>/process/conf.json</td>
<td>le fichier de conf.json contient la configuration locale minimal à l'execution du pack</td>
</tr>
<tr>
<td>/process/code.(py,jar,etc...)</td>
<td>le Code du programme sous n'importe quel format (par de contraintes)</td>
</tr>
<tr>
<td>/kibana-dashboard</td>
<td>Si besoin (pour les metric packs) ce dossier contiendra les fichiers kibana/elasticsearch pour installer les visualisations du pack</td>
</tr>
<tr>
<td>/kibana-dashboard/export.ndjson</td>
<td>le fichier de visualisations kibana</td>
</tr>
<tr>
<td>/create-table</td>
<td>Le dossier qui contient le ou les scripts SQL necéssaire au fonctionnement du pack</td>
</tr>
<tr>
<td>/create-table/create.sql</td>
<td>fichier sql</td>
</tr>
</tbody>
</table>
<h3 id="propertiesjson">Properties.json</h3>
<p>Le fichier properties.json du pack doit contenir les informations de base pour permettre de le répertorier dans le futur.</p>
<ul>
<li>name : Name of the pack</li>
<li>version : Version of the pack</li>
<li>author : author</li>
<li>description : One line description</li>
<li>mainscript : main, but can be in the <code>.sh</code> also</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;basic&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="s2">&quot;0.3.7&quot;</span><span class="p">,</span>
    <span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="s2">&quot;armand leopold&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Ce pack contient des métriques de base ainsi que l&#39;analyse du delta d&#39;un jour a l&#39;autre des mêmes metriques, et ajoute un coefficient de leur variation.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mainscript&quot;</span><span class="p">:</span><span class="s2">&quot;metrics.py&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="bootstrap-scriptsh">Bootstrap-script.sh</h3>
<p>Le fichier de bootstrap script est un fichier necéssaire qui sert de point d'entrée au programme qui va être executé. 
Si besoin, on incluera l'installation des dépendances et binaires requis pour la bonne execution du programme. 
Finalement on incluera la commande de lancement du ou des programmes du pack.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># This script will be executed first at the installation of the pack</span>
<span class="c1"># Put Here everything that needs to be installed in order for the metric script to run properly</span>

pip install --upgrade pip 
pip install -r requirements.txt
<span class="nb">cd</span> process
python metric_basic.py
</code></pre></div>
<h2 id="gestion-de-la-configuration">Gestion de la configuration</h2>
<p>La gestion de la configuration est laissé libre à l'auteur du pack dans sa très grande majorité, excepté les cas suivants : </p>
<ol>
<li>La récupération de la liste des points de terminaisons sur lesquels le pack doit s'executer.</li>
<li>La configuration spécifique à chaque point de terminaison</li>
<li>La configuration externe du pack (hors credentials) ammené à changer régulièrement.</li>
</ol>
<h3 id="1-liste-des-points-de-terminaisons-cibles">1. Liste des points de terminaisons cibles</h3>
<p>Ce que l'on entend pas "points de terminaisons cibles" sont l'ensemble des chaines de connexions ou URL auxquel le Pack accède ponctuellement pour effectuer sont travail et contre lesquels il lit et récupère des informations.</p>
<p>Cette liste de points de terminaisons est géré de façon centralisée par HDM afin d'avoir une vue d'ensemble en un coup d'oeil depuis l'interface, des différentes actions des packs.</p>
<p>La liste de ces points de terminaisons est modifiable via l'interface d'administration en cliquant sur les cases dans la matrice d'activation :</p>
<p><img alt="matrice" src="matrice-activation_1.png" /></p>
<p>A chaque activation d'un point de terminaison, une ligne est rajouté dans la table :</p>
<ul>
<li><code>hdm_core_table_corr_db_mp</code> Pour les Metric Packs</li>
<li><code>hdm_core_table_corr_db_rp</code> Pour les Rule Packs</li>
</ul>
<p>Contenant le <strong>slug</strong> de la chaine de connexion dans le champs <code>db_key</code> ainsi que le nom du pack dans : <code>mp_key</code> ou <code>rp_key</code> pour un metric pack ou un rule pack.</p>
<p>Chaque pack doit pouvoir se connecter à la base HDM pour récupérer cette configuration.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Attention, le slug de la chaine <strong>ne contient pas de credentials</strong>. Vous devrez trouver une autre manière de récuperer le mot de passe de la chaine de connexion. En utilisant un <strong>online credentials store</strong> comme <a href="https://www.vaultproject.io/">Vault</a> ou <a href="https://www.keycloak.org/">Keycloack</a>.
Vous pouvez également stocker les credentials dans la configuration locale du pack en dernier recours et seulement pour des comptes en "readonly".</p>
</div>
<h3 id="23-configuration-des-pts-de-terminaisons-et-configuration-externe-des-pack">2./3. Configuration des pts de terminaisons et configuration externe des pack</h3>
<p>HDM donne également la possibilitée de centraliser la configuration spécifique à chaque points de terminaisons pour chaque pack.</p>
<p>Dans l'interface, la configuration se situe également dans la matrice d'activation (voir image ci-dessus) à la droite du boutton d'activation.</p>
<p>La configuration est ensuite encodé en <strong>base64</strong> et stocké dans la table : </p>
<ul>
<li><code>hdm_pack_metric_conf</code> Pour les Metric Packs </li>
<li><code>hdm_pack_rule_conf</code> Pour les Rule Packs</li>
</ul>
<p>Ces tables contiennent également <code>la configuration externe du pack</code> la subtilité est la suivante : </p>
<p>L'<code>id_config</code> contient soit : </p>
<ul>
<li>L'id du pack + version : <strong>pack:version</strong> si c'est une configuration externe.</li>
<li>L'id du pack + le slug de la chaine de connexion : <strong>pack:slug</strong> si c'est une configuration lié à un point de terminaison.</li>
</ul>
<p>Cette table est également à requêter par le pack pour récupérer sa configuration et les configurations des points de terminaisons.</p>
<h2 id="orchestration-des-packs">Orchestration des packs</h2>
<p><img alt="dag-hdm.png" src="dag-hdm.png" /></p>
<p>Pour l'orchestration des packs, la solution proposée est d'utiliser un DAG Airflow.
Le dag airflow permet de centraliser l'execution des packs comme des "tâches", de configurer un rythme d'execution, de monitorer les tâches executés et le bon fonctionnement des enchainements de tâches.</p>
<p>En effet, les packs fonctionnant indépendament les un des autres peuvent néamoins necéssiter des ressources d'autres packs pour fonctionner. Par exemple, les rule packs ont besoin des metric packs pour executer leur règles. Airflow, de part son "graph" d'execution permet d'assurer un juste enchainement des packs les uns après les autres dans un ordre défini, il permet d'éviter toute corruption dans les analyses et prévient l'émission de fausses alertes.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="full-installation.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: HDM Full Installation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              HDM Full Installation
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "navigation.tabs", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.ddd52ceb.min.js"></script>
      
    
  </body>
</html>